#include "common.h"
#include "player.h"
#include <iostream>
#include <string>

// –û—á–∏—Å—Ç–∫–∞ –µ–∫—Ä–∞–Ω—É
void clearScreen() {
    #ifdef _WIN32
        system("cls");
    #else
        system("clear");
    #endif
}

// –ü–∞—É–∑–∞ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è
void pause() {
    std::cout << "\n–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è...";
    std::cin.ignore();
    std::cin.get();
}

// –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∏
void printTitle() {
    std::cout << Color::CYAN;
    std::cout << "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n";
    std::cout << "‚ïë                                                            ‚ïë\n";
    std::cout << "‚ïë            ‚öì  –ú–û–†–°–¨–ö–ò–ô –ë–Ü–ô / BATTLESHIP  ‚öì               ‚ïë\n";
    std::cout << "‚ïë                                                            ‚ïë\n";
    std::cout << "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n";
    std::cout << Color::RESET << "\n";
}

// –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é
int showMainMenu() {
    clearScreen();
    printTitle();
    
    std::cout << Color::YELLOW << "–í–∏–±–µ—Ä—ñ—Ç—å —Ä–µ–∂–∏–º –≥—Ä–∏:\n" << Color::RESET;
    std::cout << "  1. –ì—Ä–∞ –Ω–∞ –æ–¥–Ω–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ (2 –≥—Ä–∞–≤—Ü—ñ)\n";
    std::cout << "  2. –ì—Ä–∞ –ø—Ä–æ—Ç–∏ AI (–ü—Ä–æ—Å—Ç–∏–π)\n";
    std::cout << "  3. –ì—Ä–∞ –ø—Ä–æ—Ç–∏ AI (–†–æ–∑—É–º–Ω–∏–π)\n";
    std::cout << "  4. –ú–µ—Ä–µ–∂–µ–≤–∞ –≥—Ä–∞ (TODO)\n";
    std::cout << "  0. –í–∏—Ö—ñ–¥\n\n";
    std::cout << "–í–∞—à –≤–∏–±—ñ—Ä: ";
    
    int choice;
    std::cin >> choice;
    std::cin.ignore();
    
    return choice;
}

// –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–º–æ–≥—É
void displayVictory(const std::string& winner) {
    clearScreen();
    std::cout << Color::GREEN;
    std::cout << "\n";
    std::cout << "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n";
    std::cout << "‚ïë                                                            ‚ïë\n";
    std::cout << "‚ïë                    üéâ –ü–ï–†–ï–ú–û–ì–ê! üéâ                        ‚ïë\n";
    std::cout << "‚ïë                                                            ‚ïë\n";
    std::cout << "‚ïë              " << winner << " –ø–µ—Ä–µ–º—ñ–≥ —É –≥—Ä—ñ!                    ‚ïë\n";
    std::cout << "‚ïë                                                            ‚ïë\n";
    std::cout << "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n";
    std::cout << Color::RESET << "\n";
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –≥—Ä–∏
void displayRules() {
    clearScreen();
    printTitle();
    
    std::cout << Color::CYAN << "üìú –ü–†–ê–í–ò–õ–ê –ì–†–ò:\n" << Color::RESET;
    std::cout << "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n";
    
    std::cout << Color::YELLOW << "–ú–µ—Ç–∞ –≥—Ä–∏:\n" << Color::RESET;
    std::cout << "  –ó–Ω–∏—â–∏—Ç–∏ –≤—Å—ñ –∫–æ—Ä–∞–±–ª—ñ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —Ä–∞–Ω—ñ—à–µ, –Ω—ñ–∂ –≤—ñ–Ω –∑–Ω–∏—â–∏—Ç—å –≤–∞—à—ñ.\n\n";
    
    std::cout << Color::YELLOW << "–§–ª–æ—Ç (5 –∫–æ—Ä–∞–±–ª—ñ–≤):\n" << Color::RESET;
    std::cout << "  ‚Ä¢ –ê–≤—ñ–∞–Ω–æ—Å–µ—Ü—å     - 5 –∫–ª—ñ—Ç–∏–Ω–æ–∫\n";
    std::cout << "  ‚Ä¢ –õ—ñ–Ω–∫–æ—Ä         - 4 –∫–ª—ñ—Ç–∏–Ω–∫–∏\n";
    std::cout << "  ‚Ä¢ –ö—Ä–µ–π—Å–µ—Ä        - 3 –∫–ª—ñ—Ç–∏–Ω–∫–∏\n";
    std::cout << "  ‚Ä¢ –ü—ñ–¥–≤–æ–¥–Ω–∏–π —á–æ–≤–µ–Ω - 3 –∫–ª—ñ—Ç–∏–Ω–∫–∏\n";
    std::cout << "  ‚Ä¢ –ï—Å–º—ñ–Ω–µ—Ü—å       - 2 –∫–ª—ñ—Ç–∏–Ω–∫–∏\n\n";
    
    std::cout << Color::YELLOW << "–ü—Ä–∞–≤–∏–ª–∞ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è:\n" << Color::RESET;
    std::cout << "  ‚Ä¢ –ö–æ—Ä–∞–±–ª—ñ —Ä–æ–∑–º—ñ—â—É—é—Ç—å—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –∞–±–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ\n";
    std::cout << "  ‚Ä¢ –ö–æ—Ä–∞–±–ª—ñ –Ω–µ –º–æ–∂—É—Ç—å —Ç–æ—Ä–∫–∞—Ç–∏—Å—è –æ–¥–∏–Ω –æ–¥–Ω–æ–≥–æ (–Ω–∞–≤—ñ—Ç—å –∫—É—Ç–∞–º–∏)\n";
    std::cout << "  ‚Ä¢ –ö–æ—Ä–∞–±–ª—ñ –Ω–µ –º–æ–∂—É—Ç—å –≤–∏—Ö–æ–¥–∏—Ç–∏ –∑–∞ –º–µ–∂—ñ –¥–æ—à–∫–∏ 10√ó10\n\n";
    
    std::cout << Color::YELLOW << "–Ø–∫ –≥—Ä–∞—Ç–∏:\n" << Color::RESET;
    std::cout << "  ‚Ä¢ –í–≤–µ–¥—ñ—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ: A5, B3, J9 —Ç–æ—â–æ\n";
    std::cout << "  ‚Ä¢ " << Color::GRAY << "o" << Color::RESET << " - –ø—Ä–æ–º–∞—Ö\n";
    std::cout << "  ‚Ä¢ " << Color::RED << "X" << Color::RESET << " - –≤–ª—É—á–∞–Ω–Ω—è\n";
    std::cout << "  ‚Ä¢ " << Color::BLUE << "S" << Color::RESET << " - –≤–∞—à –∫–æ—Ä–∞–±–µ–ª—å\n\n";
    
    pause();
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –¥–≤—ñ –¥–æ—à–∫–∏ –ø–æ—Ä—É—á (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –≥—Ä–∏)
void displayBothPlayers(const Player& player1, const Player& player2, bool showPlayer1Ships, bool showPlayer2Ships) {
    std::cout << "\n";
    std::cout << "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n";
    std::cout << "‚ïë  " << Color::CYAN << player1.getName() << Color::RESET;
    
    // –í—ñ–¥—Å—Ç—É–ø –¥–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è
    int spaces1 = 25 - player1.getName().length();
    for (int i = 0; i < spaces1; i++) std::cout << " ";
    
    std::cout << "‚ïë  " << Color::CYAN << player2.getName() << Color::RESET;
    
    int spaces2 = 25 - player2.getName().length();
    for (int i = 0; i < spaces2; i++) std::cout << " ";
    
    std::cout << "‚ïë\n";
    std::cout << "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n";
}

// –ü–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –Ω–æ–≤—É –≥—Ä—É
bool askPlayAgain() {
    std::cout << "\n" << Color::YELLOW << "–ó—ñ–≥—Ä–∞—Ç–∏ —â–µ —Ä–∞–∑? (y/n): " << Color::RESET;
    std::string answer;
    std::getline(std::cin, answer);
    
    return (answer == "y" || answer == "Y" || answer == "yes" || answer == "Yes" || 
            answer == "—Ç" || answer == "–¢" || answer == "—Ç–∞–∫" || answer == "–¢–∞–∫");
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∞—Ç—á—É
void displayMatchStats(const Player& player1, const Player& player2) {
    std::cout << "\n";
    std::cout << "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n";
    std::cout << "‚ïë                    üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ú–ê–¢–ß–£                     ‚ïë\n";
    std::cout << "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£\n";
    
    std::cout << "‚ïë  " << Color::CYAN << player1.getName() << Color::RESET << ":\n";
    std::cout << "‚ïë    –ü–æ—Å—Ç—Ä—ñ–ª—ñ–≤: " << player1.getShotsCount() 
              << " | –í–ª—É—á–∞–Ω—å: " << Color::GREEN << player1.getHitsCount() << Color::RESET
              << " | –¢–æ—á–Ω—ñ—Å—Ç—å: " << Color::YELLOW << player1.getAccuracy() << "%" << Color::RESET << "\n";
    std::cout << "‚ïë\n";
    
    std::cout << "‚ïë  " << Color::CYAN << player2.getName() << Color::RESET << ":\n";
    std::cout << "‚ïë    –ü–æ—Å—Ç—Ä—ñ–ª—ñ–≤: " << player2.getShotsCount()
              << " | –í–ª—É—á–∞–Ω—å: " << Color::GREEN << player2.getHitsCount() << Color::RESET
              << " | –¢–æ—á–Ω—ñ—Å—Ç—å: " << Color::YELLOW << player2.getAccuracy() << "%" << Color::RESET << "\n";
    
    std::cout << "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n";
}

// –ê–Ω—ñ–º–∞—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
void showLoadingAnimation(const std::string& message, int duration = 3) {
    std::cout << Color::CYAN << message << Color::RESET;
    for (int i = 0; i < duration; i++) {
        std::cout << "." << std::flush;
        #ifdef _WIN32
            Sleep(300);
        #else
            usleep(300000);
        #endif
    }
    std::cout << "\n";
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ö–æ–¥—É
void displayTurnInfo(const std::string& playerName, int turnNumber) {
    std::cout << "\n";
    std::cout << "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n";
    std::cout << "‚ïë  " << Color::YELLOW << "–•–Ü–î #" << turnNumber << Color::RESET;
    
    std::string turnStr = "–•–Ü–î #" + std::to_string(turnNumber);
    int spaces = 54 - turnStr.length();
    for (int i = 0; i < spaces; i++) std::cout << " ";
    
    std::cout << "‚ïë\n";
    std::cout << "‚ïë  –ì—Ä–∞–≤–µ—Ü—å: " << Color::CYAN << playerName << Color::RESET;
    
    spaces = 45 - playerName.length();
    for (int i = 0; i < spaces; i++) std::cout << " ";
    
    std::cout << "‚ïë\n";
    std::cout << "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n";
}

// –ï–∫—Ä–∞–Ω –∑–º—ñ–Ω–∏ –≥—Ä–∞–≤—Ü—è (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –≥—Ä–∏)
void showPlayerSwitchScreen(const std::string& nextPlayer) {
    clearScreen();
    std::cout << "\n\n\n";
    std::cout << Color::YELLOW;
    std::cout << "        ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n";
    std::cout << "        ‚ïë                                          ‚ïë\n";
    std::cout << "        ‚ïë         –ü–ï–†–ï–î–ê–ô–¢–ï –ö–û–ú–ü'–Æ–¢–ï–†             ‚ïë\n";
    std::cout << "        ‚ïë                                          ‚ïë\n";
    std::cout << "        ‚ïë         üéÆ  " << nextPlayer;
    
    int spaces = 20 - nextPlayer.length();
    for (int i = 0; i < spaces; i++) std::cout << " ";
    
    std::cout << "üéÆ          ‚ïë\n";
    std::cout << "        ‚ïë                                          ‚ïë\n";
    std::cout << "        ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n";
    std::cout << Color::RESET;
    
    pause();
    clearScreen();
}